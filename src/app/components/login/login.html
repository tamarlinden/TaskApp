<div class="login-container">
  <h2>{{ isRegisterMode() ? 'הרשמה למערכת' : 'התחברות למערכת' }}</h2>

  @if (errorMessage()) {
    <div class="error-global">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
      {{ errorMessage() }}
    </div>
  }

  <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" autocomplete="off">
    @if (isRegisterMode()) {
      <div class="form-group">
        <label>שם מלא:</label>
        <input type="text" formControlName="name" placeholder="הכנס את שמך המלא">
        @if (loginForm.get('name')?.invalid && (loginForm.get('name')?.touched || submitted)) {
          <small>שם חובה</small>
        }
      </div>
    }

    <div class="form-group">
      <label>אימייל:</label>
      <input type="email" formControlName="email" placeholder="your@email.com" class="ltr-input" dir="ltr">
      @if (loginForm.get('email')?.invalid && (loginForm.get('email')?.touched || submitted)) {
        <small>אימייל לא תקין</small>
      }
    </div>

    <div class="password-row form-group">
      <label>סיסמה:</label>
      <div class="password-input-wrapper">
        <input [type]="showPassword ? 'text' : 'password'" formControlName="password" placeholder="הכנס סיסמה (לפחות 6 תווים)">
        <button type="button" class="eye-btn" (click)="toggleShowPassword()" tabindex="-1" aria-label="הצג סיסמה">
          @if (showPassword) {
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
              <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
          } @else {
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
              <path d="M17.94 17.94A10.94 10.94 0 0 1 12 19c-7 0-11-7-11-7a21.77 21.77 0 0 1 5.06-6.06M1 1l22 22"/>
              <path d="M9.53 9.53A3 3 0 0 0 12 15a3 3 0 0 0 2.47-5.47"/>
            </svg>
          }
        </button>
      </div>
      @if (loginForm.get('password')?.invalid && (loginForm.get('password')?.touched || submitted)) {
        <small>סיסמה חייבת להכיל לפחות 6 תווים</small>
      }
    </div>

    <button type="submit" [disabled]="loginForm.invalid || isLoading()" [class.loading]="isLoading()">
      @if (isLoading()) {
        <span class="loader" aria-label="טוען"></span>
      } @else {
        @if (!isRegisterMode()) {
          {{ 'התחבר למערכת' }}
          <svg class="submit-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h4"/>
            <polyline points="14 7 9 12 14 17"/>
            <line x1="9" y1="12" x2="21" y2="12"/>
          </svg>
        } @else {
          {{ 'הרשם עכשיו' }}
        }
      }
    </button>
  </form>

  <p>
    {{ isRegisterMode() ? 'כבר יש לך חשבון?' : 'אין לך חשבון עדיין?' }}
    <button type="button" (click)="toggleMode()">
      {{ isRegisterMode() ? 'התחבר' : 'הרשם עכשיו' }}
    </button>
  </p>
</div>